var brite=brite||{};(function(c){var b={};var i={};var f={};brite.registerComponent=function(p,o,r){var q={};q.name=p;q.componentFactory=r;q.config=o;b[p]=q;var n=i[p];if(n){n.resolve(q);delete i[p]}};brite.instantiateComponent=function(n){var o=d(n);return h(componentDef)};brite.registerTransition=function(n,o){f[n]=o};brite.getTransition=function(n){return f[n]};brite.display=function(n,p,o){return a(n,p,o)};brite.attach=function(o,n,q,p){return a(o,q,p,n)};brite.config={componentsHTMLHolder:"body",componentsPath:"components/"};brite.defaultComponentConfig={emptyParent:false,postDisplayDelay:0};function d(n){var o=c.Deferred();var q=b[n];if(q){o.resolve(q)}else{var p=i[n];if(p){o=p}else{i[n]=o;c.ajax({url:brite.config.componentsPath+n+".html",async:true}).complete(function(r,s){c(brite.config.componentsHTMLHolder).append(r.responseText)})}}return o.promise()}function a(n,t,r,w){var p=d(n);var s=c.Deferred();var v=c.Deferred();var q=c.Deferred();var o=c.Deferred();var u=s.promise();u.whenCreate=v.promise();u.whenInit=q.promise();u.whenPostDisplay=o.promise();p.done(function(B){r=j(B,r);var z=h(B);if(r.unique){var x=c("[data-bcomponent='"+n+"']");if(x.length>0){z=x.bComponent();s.resolve(z);return s}}var A=c.Deferred();if(!w){var y=g(z,t,r);if(y&&c.isFunction(y.promise)&&!y.jquery){y.done(function(C){A.resolve(C)}).fail(function(){A.reject()})}else{if(y){w=c(y)}A.resolve(w)}}else{A.resolve(w)}A.promise().done(function(C){if(C){C=c(C);e(C,z,t,r);C.data("componentProcessPromise",u);v.resolve(z);c.when(l(z,t,r)).done(function(){m(z,t,r);q.resolve(z)})}else{v.resolve(z);q.resolve(z)}u.whenInit.done(function(){var E,D;if(C&&C.parent()){var F=C.parent().closest("[data-bcomponent]");if(F.length>0){E=F.data("componentProcessPromise");E.whenPostDisplay.done(function(){D=k(z,t,r);D.done(function(){o.resolve(z)})})}}if(!E){D=k(z,t,r);D.done(function(){o.resolve(z)})}})});u.whenPostDisplay.done(function(){s.resolve(z)})});return u}function m(o,p,n){if(n.transition){var q=brite.getTransition(n.transition);if(q){q(o,p,n)}else{brite.log.error("Transition ["+n.transition+"] not found. Transitions need to be registered via brite.registerTranstion(..) before call.")}}else{if(n.replace){c(n.replace).bRemove()}if(n.parent){if(n.emptyParent){c(n.parent).bEmpty()}c(n.parent).append(o.$element)}}}function j(o,n){var p=c.extend({},this.defaultComponentConfig,o.config,n);p.componentName=o.name;return p}function h(p){var n;var o=p.componentFactory;if(o){if(c.isFunction(o)){n=o()}else{if(c.isPlainObject(o)){n=c.extend({},o)}else{brite.log.error("Invalid ComponentFactory for component ["+p.componentName+"]. Only types Function or Object are supported as componentFactory. Empty component will be created.")}}}else{brite.log.error("No ComponentFactory for component ["+p.componentName+"]")}if(n){n.name=p.name}return n}function g(o,p,n){var q=o.create||o.build;if(!q||!c.isFunction(q)){brite.log.error("Invalid 'create' function for component ["+o.name+"].");return}return q.call(o,p,n)}function l(o,p,n){var q=o.init;if(c.isFunction(q)){return q.call(o,p,n)}}function e(n,p,q,o){p.$element=n;n.data("component",p);n.attr("data-bcomponent",o.componentName)}function k(o,r,n){var q=c.Deferred();if(o.postDisplay){if(n.postDisplayDelay>=0){setTimeout(function(){var s=o.postDisplay(r,n);if(s&&c.isFunction(s)){s.done(function(){q.resolve()})}else{q}},n.postDisplayDelay)}else{var p=o.postDisplay(r,n);if(p&&c.isFunction(p)){p.done(function(){q.resolve()})}else{q.resolve()}}}else{q.resolve()}return q.promise()}})(jQuery);(function(c){c.fn=c.fn;c.fn.bComponent=function(d){var e;if(d){e=c(this).closest("[data-bcomponent='"+d+"']")}else{e=c(this).closest("[data-bcomponent]")}return e.data("component")};c.fn.bFindComponents=function(d){var e=[];this.each(function(){var f=c(this);var g;if(d){g=c(this).find("[data-bcomponent='"+d+"']")}else{g=c(this).find("[data-bcomponent]")}g.each(function(){var h=c(this);e.push(h.data("component"))})});return e};c.fn.bFindFirstComponent=function(d){var e=[];this.each(function(){var f=c(this);var g;if(d){g=c(this).find("[data-bcomponent='"+d+"']:first")}else{g=c(this).find("[data-bcomponent]:first")}g.each(function(){var h=c(this);e.push(h.data("component"))})});return e};c.fn.bEmpty=function(){return this.each(function(){var e=c(this);var d=e.bFindComponents();c.each(d,function(g,f){a(f)});e.empty();c.each(d,function(g,f){b(f)})})};c.fn.bRemove=function(){return this.each(function(){var e=c(this);e.bEmpty();if(e.is("[data-bcomponent]")){var d=e.data("component");a(d);e.remove();b(d)}else{e.remove()}})};function a(d){if(d){var e=d.destroy||d.preRemove;if(c.isFunction(e)){e.call(d)}}}function b(e){if(e){var d=e.postDestroy||e.postRemove;if(c.isFunction(d)){d.call(e)}}}})(jQuery);(function(f){var c="INFO",d="ERROR",b="DEBUG";var g=null;brite.log={config:{debugMode:false,consoleLog:true},info:function(h){e(h)},error:function(h){e(h,d)},debug:function(h){if(brite.log.config.debugMode){e(h,b)}},addPrinter:function(h){g=g||[];g.push(h)}};function e(o,n){if(brite.log.config.consoleLog){a(o,n)}if(g){var m,k=n||c;for(var j=0,h=g.length;j<h;j++){m=g[j];m(o,k)}}}function a(i,h){if(window.console&&window.console.log){if(h){i=h+" - "+i}console.log(i)}}})(jQuery);brite.util={};(function(b){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");brite.util.uuid=function(c,f){var g=a,e=[];f=f||g.length;c=c||10;for(var d=0;d<c;d++){e[d]=g[0|Math.random()*f]}return e.join("")};brite.util.array={remove:function(c,f,e){var d=c.slice((e||f)+1||c.length);c.length=f<0?c.length+f:f;return c.push.apply(c,d)},getIndex:function(d,f,h){if(d&&f&&typeof h!="undefined"){var e,g,c=d.length;for(var e=0;e<c;e++){g=d[e];if(g&&g[f]===h){return e}}}return -1},sortBy:function(c,d){return c.sort(e);function e(h,g){if(typeof h==="undefined"){return -1}if(typeof g==="undefined"){return 1}var f=h[d];var i=g[d];return((f<i)?-1:((f>i)?1:0))}},toMap:function(d,g){var f,c=d.length;var j={},h,e;for(f=0;f<c;f++){h=d[f];e=h[g];if(typeof e!="undefined"&&e!=null){j[e]=h}}return j}};brite.util.randomInt=function(e,d){var c=d-e;return e+Math.floor(Math.random()*(c+1))};brite.util.inherit=function(e,d){var c=function(){};c.prototype=d.prototype;e.prototype=new c();e.prototype._super=d.prototype;e.prototype.constructor=e}})(jQuery);brite.ua={};(function(h){var k="-webkit-",b="-moz-";var g="Webkit",o="Moz";var d,e,a=null,q=null,f=null,u={};var n=document.createElement("div");e=n.style.WebkitBorderRadius===""?k:(n.style.MozBorderRadius===""?b:(n.style.borderRadius===""?"":""));delete n;var j=(e===b);var r=(e===k);d=(j)?o:(r)?g:"";brite.ua.cssPrefix=function(){return e};brite.ua.cssVarPrefix=function(){return d};var v=["transform"];var m;for(var t=0,s=v.length;t<s;t++){m=v[t];h.cssHooks[m]=new c(m)}function c(i){this.propName=i;this.computedName=d+i.substr(0,1).toUpperCase()+i.substr(1)}c.prototype.get=function(w,l,i){return h.css(w,this.computedName)};c.prototype.set=function(i,l){i.style[this.computedName]=l};brite.ua.hasEvent=function(i){var l=u[i];if(typeof l==="undefined"){l=p(i);u[i]=l}return l};brite.ua.hasTouch=function(){return this.hasEvent("touchstart")};brite.ua.transitionPrefix=function(){if(this.hasTransition()){return f}else{return null}};brite.ua.hasTransition=function(){if(q===null){var i=document.createElement("div");i.innerHTML='<div style="-webkit-transition:color 1s linear;-moz-transition:color 1s linear;"></div>';f=(i.firstChild.style.webkitTransition!==undefined)?k:f;f=(i.firstChild.style.MozTransition!==undefined)?b:f;delete i;q=(f!=null)}return q};var p=(function(){var l={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};function i(w){var y=document.createElement(l[w]||"div");w="on"+w;var x=(w in y);if(!x){y.setAttribute(w,"return;");x=typeof y[w]=="function"}y=null;return x}return i})()})(jQuery);(function(e){brite.gtx=function b(g){var h=g;if(g.jquery){g=g.get(0)}if(e.isFunction(g.getContext)){h=g.getContext("2d")}if(!(this instanceof b)){return new b(h)}this.context=this.ctx=h;if(!this.beginPath){a()}};brite.gtx.prototype.referenceScale=function(h,g){this._refWidth=h;this._refHeight=g;computeRatio.call(this);return this};brite.gtx.prototype.fitParent=function(){var g=this.canvas();if(g){var g=this.canvas();var h=e(g).parent();g.width=h.width();g.height=h.height()}computeRatio.call(this);return this};brite.gtx.prototype.clear=function(){if(this.canvas()){this.canvas().width=this.canvas().width}return this};brite.gtx.prototype.arc=function(h,l,g,j,i,k){this.context.arc(h,l,g,j,i,k);return this};brite.gtx.prototype.arcTo=function(i,k,h,j,g){this.context.arcTo(i,k,h,j,g);return this};brite.gtx.prototype.bezierCurveTo=function(i,h,k,j,g,l){this.context.bezierCurveTo(i,h,k,j,g,l);return this};brite.gtx.prototype.quadraticCurveTo=function(i,h,g,j){this.context.quadraticCurveTo(cp1x,cp1y,cp2x,cp2y,g,j);return this};brite.gtx.prototype.rect=function(g,k,i,j){return d.call(this,"rect",g,k,i,j)};brite.gtx.prototype.clearRect=function(g,k,i,j){return d.call(this,"clearRect",g,k,i,j)};brite.gtx.prototype.fillRect=function(g,k,i,j){return d.call(this,"fillRect",g,k,i,j)};brite.gtx.prototype.strokeRect=function(g,k,i,j){return d.call(this,"strokeRect",g,k,i,j)};function d(j,g,l,i,k){this.context[j](g,l,i,k);return this}brite.gtx.prototype.moveTo=function(g,h){this.context.moveTo(g,h);return this};brite.gtx.prototype.lineTo=function(g,h){this.context.lineTo(g,h);return this};brite.gtx.prototype.translate=function(g,h){this.context.translate(g,h);return this};brite.gtx.prototype.createLinearGradient=function(i,k,h,j){var l=this.ctx.createLinearGradient(i,k,h,j);var g=new f(l);return g};brite.gtx.prototype.createRadialGradient=function(k,m,j,i,l,h){var n=this.ctx.createRadialGradient(k,m,j,i,l,h);var g=new f(n);return g};brite.gtx.prototype.fillStyle=function(g){return c(this,"fillStyle",g)};brite.gtx.prototype.strokeStyle=function(g){return c(this,"strokeStyle",g)};function c(j,i,h){if(!h){return j.ctx[i]}if(h.ctxGradient){h=h.ctxGradient}j.ctx[i]=h;return j}function f(g){this.ctxGradient=g}f.prototype.addColorStop=function(){this.ctxGradient.addColorStop.apply(this.ctxGradient,arguments);return this};f.prototype.addColorStops=function(){for(var g=0;(g+1)<arguments.length;g+=2){this.ctxGradient.addColorStop(arguments[g],arguments[g+1])}return this};function a(){var j=["beginPath","clip","closePath","drawImage","fill","fillText","restore","rotate","save","scale","setTransform","stroke","strokeText","transform",];var q=["createPattern","drawFocusRing","isPointInPath","measureText","createImageData","getImageData","putImageData"];var r=["canvas","font","globalAlpha","globalCompositeOperation","lineCap","lineJoin","lineWidth","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","textAlign","textBaseline"];var h,s;for(var n=0,o=j.length;n<o;n++){var k=j[n];brite.gtx.prototype[k]=(function(i){return function(){this.ctx[i].apply(this.ctx,arguments);return this}}(k))}for(n=0,h=q.length;n<h;n++){var l=q[n];brite.gtx.prototype[l]=(function(i){return function(){return this.ctx[i].apply(this.ctx,arguments)}}(l))}for(n=0,s=r.length;n<s;n++){var g=r[n];brite.gtx.prototype[g]=(function(i){return function(m){if(typeof m==="undefined"){return this.ctx[i]}this.ctx[i]=m;return this}}(g))}}})(jQuery);brite.dm={};(function(e){var b={};var d={};function a(h){var g=b[h];if(g){return g}else{var i="Cannot find the DAO for objectType: "+h;brite.log.error(i);throw i}}brite.registerDao=function(h,g){b[h]=g;return this};brite.addDataChangeListener=function(g,j){var i=brite.util.uuid();var h=d[g];if(!h){h={};d[g]=h}h[i]=j;return i};brite.removeDataChangeListener=function(g){e.each(d,function(h,i){delete i[g]})};brite.dm.getIdName=function(g){return brite.sdm.getIdName(g)};brite.dm.get=function(g,h){return f(brite.sdm.get(g,h))};brite.dm.list=function(g,h){return f(brite.sdm.list(g,h))};brite.dm.create=function(g,h){return f(brite.sdm.create(g,h))};brite.dm.update=function(g,i,h){return f(brite.sdm.update(g,i,h))};brite.dm.remove=function(g,h){return f(brite.sdm.remove(g,h))};brite.sdm={};brite.sdm.getIdName=function(g){return a(g).getIdName(g)};brite.sdm.get=function(g,h){return a(g).get(g,h)};brite.sdm.list=function(g,h){return a(g).list(g,h)};brite.sdm.create=function(h,i){var g=a(h).create(h,i);if(g&&e.isFunction(g.promise)){g.done(function(j){c(h,"create",null,j,i)})}else{c(h,"create",null,g,i)}return g};brite.sdm.update=function(h,j,i){var g=a(h).update(h,j,i);if(g&&e.isFunction(g.promise)){g.done(function(k){c(h,"update",null,k,i)})}else{c(h,"update",null,g,i)}return g};brite.sdm.remove=function(h,i){var g=a(h).remove(h,i);if(g&&e.isFunction(g.promise)){g.done(function(j){c(h,"remove",j,null,null)})}else{c(h,"remove",g,null,null)}};function c(h,m,k,g){var j=d[h],l;var i={objectType:h,action:m,newData:k,saveData:g};if(j){e.each(j,function(n,o){o(i)})}}function f(h){if(h&&e.isFunction(h.promise)){return h}else{var g=e.Deferred();g.resolve(h);return g}}})(jQuery);brite.dao={};(function(b){function a(c){this.init(c)}a.prototype.init=function(c){this._store=c||[];return this};a.prototype.getIdName=function(c){return"id"};a.prototype.get=function(d,e){var c=brite.util.array.getIndex(this._store,"id",e);return this._store[c]};a.prototype.list=function(c,e){var d=this._store;if(e){if(e.orderBy){d=brite.util.array.sortBy(d,e.orderBy)}if(e.match){d=b.map(d,function(h,f){var g=true;b.each(e.match,function(j,i){if(h[j]===i){g=g&&true}else{g=false}});return(g)?h:null})}}return d};a.prototype.create=function(c,e){var d=brite.dm.getIdName(c);if(typeof e[d]!=="undefined"){var f="SimpleDao.create error: Id present in data object. Cannot create. You might want to call update instead.";brite.log.debug(f);throw f}e[d]=brite.util.uuid(12);this._store.push(e);return e};a.prototype.update=function(c,i,g){var e=brite.dm.getIdName(c);var d=g[e];if(typeof d!=="undefined"&&d!=i){var h="SimpleDao.update error: Id in param and data does not match. Cannot update data.";brite.log.debug(h);throw h}delete g[e];var f=this.get(c,i);if(f){b.extend(f,g);return f}};a.prototype.remove=function(d,g){var e=this.get(d,g);var c=brite.util.array.getIndex(this._store,"id",g);if(c>-1){brite.util.array.remove(this._store,c)}else{var f="SimpleDao.remove error: Ojbect "+d+"["+g+"] not found. Cannot delete.";brite.log.debug(f);throw f}return e};brite.dao.SimpleDao=a})(jQuery);(function(c){function b(e,f){this._super.init.call(this,e);this._rels=f;this._relDic={};for(var g=0,d=f.length;g<d;g++){this._relDic[f[g]]=f[g]+"_id"}}brite.util.inherit(b,brite.dao.SimpleDao);b.prototype.get=function(e,f){var d=this._super.get.call(this,e,f);return a.call(this,d)};b.prototype.list=function(e,g){var f=this._super.list.call(this,e,g);if(this._rels){var d=this;c.each(f,function(h,i){a.call(d,i)})}return f};b.prototype.save=function(g,j){if(this._rels){var e;for(var h=0,f=this._rels.length;h<f;h++){e=this._rels[h];if(typeof j[e]!=="undefined"){delete j[e]}}}var d=this._super.save.call(this,g,j);return a.call(this,d)};function a(k){var f=this._rels;var d,e,j,h;for(var g=0;g<f.length;g++){d=f[g];e=this._relDic[d];h=k[e];if(typeof h!=="undefined"){j=brite.dm.get(d,h);if(typeof j!=="undefined"&&j!=null){k[d]=j}}}return k}brite.dao.SimpleRelDao=b})(jQuery);(function(a){a.fn.bObjRef=function(d){var b=[];var c=null;this.each(function(){var f=a(this);var e;if(d){e=f.closest("[data-obj_type='"+d+"']")}else{e=f.closest("[data-obj_type]")}if(e.length>0){var g={type:e.attr("data-obj_type"),id:e.attr("data-obj_id"),$element:e};b.push(g)}});if(b.length===0){return null}else{if(b.length===1){return b[0]}else{return b}}}})(jQuery);brite.event=brite.event||{};(function(b){var a=brite.ua.hasTouch();brite.event.fixTouchEvent=function(c){if(a){var d=c.originalEvent;if(d.touches.length>0){c.pageX=d.touches[0].pageX;c.pageY=d.touches[0].pageY}}return c};brite.event.eventPagePosition=function(c){if(c.originalEvent&&c.originalEvent.touches){pageX=c.originalEvent.touches[0].pageX;pageY=c.originalEvent.touches[0].pageY}else{pageX=c.pageX;pageY=c.pageY}return{pageX:pageX,pageY:pageY}}})(jQuery);(function(a){a.fn.bTouch=function(d,c){var f=c||d;var e=(c)?d:null;var b=(brite.ua.hasTouch())?"touchend":"click";return this.each(function(){var g=a(this);if(e){g.delegate(e,b,f)}else{g.bind(b,f)}})};a.fn.bTouch.defaults={}})(jQuery);(function(h){var k="bdragstart",o="bdrag",n="bdragend";var c="bdragenter",b="bdragover",j="bdragleave",f="bdrop";var m={start:"mousedown",drag:"mousemove",end:"mouseup"};var i={start:"touchstart",drag:"touchmove",end:"touchend"};h.fn.bDrag=function(r,s){var p=s||r;var r=(s)?r:null;var t=brite.ua.hasTouch();p=h.extend({},h.fn.bDrag.defaults,p);var u=(t)?i:m;return this.each(function(){var v=h(this);if(r==null){(p.start)?v.bind(k,p.start):null;(p.drag)?v.bind(o,p.drag):null;(p.end)?v.bind(n,p.end):null;v.bind(u.start,function(w){q.call(this,w,p)})}else{(p.start)?v.delegate(r,k,p.start):null;(p.drag)?v.delegate(r,o,p.drag):null;(p.end)?v.delegate(r,n,p.end):null;v.delegate(r,u.start,function(w){q.call(this,w,p)})}});function q(B,D){var w=h(this);var y=h(document);var v="_"+brite.util.uuid(7);var x=false;var A=B;var z=brite.event.eventPagePosition(A);var C;B.preventDefault();y.bind(u.drag+"."+v,function(J){if(!x){var H=brite.event.eventPagePosition(J);if(Math.abs(z.pageX-H.pageY)>D.threshold){x=true;w.data("bDragCtx",{});if(D.draggable===true){if(h.isFunction(D.helper)){C=h(D.helper.call(w.get(0)))}else{if(D.helper==="original"){C=w}else{if(D.helper==="clone"){C=w.clone();C.attr("id",null);C.css("position","absolute");var I=w.offset();C.css({top:I.top,left:I.left});h("body").append(C)}}}}var F=g(A,w,C,k);w.trigger(k,[F])}}if(x){var G=g(J,w,C,o);var E;if(D.draggable===true){E=e(C,G);G.overElement=E}w.trigger(o,[G]);if(D.draggable===true){a(C,G);var K=l(w,C);d(b,J,w,E,K)}J.preventDefault();J.stopPropagation()}});y.bind(u.end+"."+v,function(G){if(x){var F=g(G,w,C,n);var H;var E;if(D.draggable===true){E=e(C,F);F.overElement=E}w.trigger(n,[F]);if(D.draggable===true){a(C,F);H=l(w,C);d(f,G,w,E,H);if(!C.is(w)){C.remove()}}w.data("bDragCtx",null);G.preventDefault();G.stopPropagation()}h(document).unbind(u.drag+"."+v);h(document).unbind(u.end+"."+v)})}};function a(q,p){var r=q.position();q.css({left:r.left+p.deltaPageX,top:r.top+p.deltaPageY})}function d(t,s,u,z,x){var v=h(z);var r=u.data("bDragCtx");var y=r.overElem;var w,q;if(typeof y==="undefined"){w=h.Event(s);w.target=z;w.type=c;v.trigger(w,x)}else{if(y!=z){q=h.Event(s);q.target=y;q.type=j;h(y).trigger(q,x);w=h.Event(s);w.target=z;w.type=c;v.trigger(w,x)}}r.overElem=z;var p=h.Event(s);p.target=z;p.type=t;v.trigger(p,x)}function e(r,q){r.hide();var p=document.elementFromPoint(q.pageX,q.pageY);r.show();return p}function g(t,q,v,s){brite.event.fixTouchEvent(t);var u=brite.ua.hasTouch();var p={eventSource:t,pageX:t.pageX,pageY:t.pageY};if(v){p.helperElement=v.get(0)}var w=t.originalEvent;if(u){p.touches=w.touches}var r=q.data("bDragCtx");if(s===k){r.startPageX=p.startPageX=p.pageX;r.startPageY=p.startPageY=p.pageY;r.lastPageX=r.startPageX=p.startPageX;r.lastPageY=r.startPageY=p.startPageY}else{if(s===n){p.pageX=r.lastPageX;p.pageY=r.lastPageY}}p.startPageX=r.startPageX;p.startPageY=r.startPageY;p.deltaPageX=p.pageX-r.lastPageX;p.deltaPageY=p.pageY-r.lastPageY;r.lastPageX=p.pageX;r.lastPageY=p.pageY;return p}function l(q,r){var p={};p.draggableElement=q.get(0);p.helperElement=r.get(0);return p}h.fn.bDrag.defaults={draggable:false,helper:"original",threshold:5}})(jQuery);